<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quantifying uncertainty in (differential) rhythmicity • limorhyde2</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Quantifying uncertainty in (differential) rhythmicity">
<meta property="og:description" content="limorhyde2">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">limorhyde2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9018</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/differential-rhythmicity.html">Quantifying differential rhythmicity between conditions</a>
    </li>
    <li>
      <a href="../articles/rhythmicity.html">Quantifying rhythmicity in one condition</a>
    </li>
    <li>
      <a href="../articles/uncertainty.html">Quantifying uncertainty in (differential) rhythmicity</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hugheylab/limorhyde2/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="uncertainty_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Quantifying uncertainty in (differential) rhythmicity</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/hugheylab/limorhyde2/blob/master/vignettes/uncertainty.Rmd"><code>vignettes/uncertainty.Rmd</code></a></small>
      <div class="hidden name"><code>uncertainty.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Here we show how to use <code>limorhyde2</code> to quantify uncertainty in rhythmicity and differential rhythmicity. This step is not essential and can be computationally expensive, but can provide additional information. Since <code>limorhyde2</code> is a Bayesian approach and focuses on effect sizes rather than statistical significance, a key concept is the <a href="https://en.wikipedia.org/wiki/Credible_interval">credible interval</a>.</p>
<p>The data are based on liver samples from wild-type and Rev-erb<span class="math inline">\(\alpha/\beta\)</span> double-knockout mice (<a href="https://doi.org/10.1038/nature11048">Cho et al. 2012</a> and <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE34018">GSE34018</a>).</p>
</div>
<div id="load-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#load-packages" class="anchor"></a>Load packages</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://wilkelab.org/cowplot/">'cowplot'</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://r-datatable.com">'data.table'</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org">'ggplot2'</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/hugheylab/limorhyde2">'limorhyde2'</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/traversc/qs">'qs'</a></span><span class="op">)</span>

<span class="fu">doParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="load-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-the-data" class="anchor"></a>Load the data</h2>
<p>The expression data are in a matrix with one row per gene and one column per sample. The metadata are in a table with one row per sample. To save time and space, the expression data include only 500 genes.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/qs/man/qread.html">qread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">'extdata'</span>, <span class="st">'GSE34018_data.qs'</span>, package <span class="op">=</span> <span class="st">'limorhyde2'</span><span class="op">)</span><span class="op">)</span>
<span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>
<span class="co">#&gt;       GSM840516 GSM840517 GSM840518 GSM840519 GSM840520</span>
<span class="co">#&gt; 12686 11.962830 11.923338 11.098814 10.958933  9.256413</span>
<span class="co">#&gt; 13170  8.989743  9.132606 12.381036 12.441759 14.766070</span>
<span class="co">#&gt; 26897 11.515292 11.625519 10.579969 10.601969 11.096489</span>
<span class="co">#&gt; 11287  7.985859  7.930935  7.674688  7.899531  7.768563</span>
<span class="co">#&gt; 11449  7.845230  7.721245  8.008705  7.909663  7.808442</span>

<span class="va">metadata</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/qs/man/qread.html">qread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">'extdata'</span>, <span class="st">'GSE34018_metadata.qs'</span>, package <span class="op">=</span> <span class="st">'limorhyde2'</span><span class="op">)</span><span class="op">)</span>
<span class="va">metadata</span>
<span class="co">#&gt;        sample      cond time</span>
<span class="co">#&gt;  1: GSM840516 wild-type    0</span>
<span class="co">#&gt;  2: GSM840517 wild-type    0</span>
<span class="co">#&gt;  3: GSM840518 wild-type    4</span>
<span class="co">#&gt;  4: GSM840519 wild-type    4</span>
<span class="co">#&gt;  5: GSM840520 wild-type    8</span>
<span class="co">#&gt;  6: GSM840521 wild-type    8</span>
<span class="co">#&gt;  7: GSM840522 wild-type   12</span>
<span class="co">#&gt;  8: GSM840523 wild-type   12</span>
<span class="co">#&gt;  9: GSM840524 wild-type   16</span>
<span class="co">#&gt; 10: GSM840525 wild-type   16</span>
<span class="co">#&gt; 11: GSM840526 wild-type   20</span>
<span class="co">#&gt; 12: GSM840527 wild-type   20</span>
<span class="co">#&gt; 13: GSM840504  knockout    0</span>
<span class="co">#&gt; 14: GSM840505  knockout    0</span>
<span class="co">#&gt; 15: GSM840506  knockout    4</span>
<span class="co">#&gt; 16: GSM840507  knockout    4</span>
<span class="co">#&gt; 17: GSM840508  knockout    8</span>
<span class="co">#&gt; 18: GSM840509  knockout    8</span>
<span class="co">#&gt; 19: GSM840510  knockout   12</span>
<span class="co">#&gt; 20: GSM840511  knockout   12</span>
<span class="co">#&gt; 21: GSM840512  knockout   16</span>
<span class="co">#&gt; 22: GSM840513  knockout   16</span>
<span class="co">#&gt; 23: GSM840514  knockout   20</span>
<span class="co">#&gt; 24: GSM840515  knockout   20</span>
<span class="co">#&gt;        sample      cond time</span></code></pre></div>
</div>
<div id="fit-linear-models-and-compute-posterior-fits" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-linear-models-and-compute-posterior-fits" class="anchor"></a>Fit linear models and compute posterior fits</h2>
<p>Because the samples were only acquired every four hours, we somewhat arbitrarily use three knots instead of the default four. We specify <code>condColname</code> so <code><a href="../reference/getModelFit.html">getModelFit()</a></code> knows to fit a differential rhythmicity model.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/getModelFit.html">getModelFit</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">metadata</span>, nKnots <span class="op">=</span> <span class="fl">3L</span>, condColname <span class="op">=</span> <span class="st">'cond'</span><span class="op">)</span>
<span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/getPosteriorFit.html">getPosteriorFit</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>
<span class="co">#&gt;  - Computing 500 x 109 likelihood matrix.</span>
<span class="co">#&gt;  - Likelihood calculations took 0.32 seconds.</span>
<span class="co">#&gt;  - Fitting model with 109 mixture components.</span>
<span class="co">#&gt;  - Model fitting took 0.08 seconds.</span>
<span class="co">#&gt;  - Computing posterior matrices.</span>
<span class="co">#&gt;  - Computation allocated took 0.14 seconds.</span></code></pre></div>
</div>
<div id="draw-samples-from-the-posterior-fits" class="section level2">
<h2 class="hasAnchor">
<a href="#draw-samples-from-the-posterior-fits" class="anchor"></a>Draw samples from the posterior fits</h2>
<p>The posterior fits consist of not just a single set of model coefficients (the posterior means), but distributions of model coefficients. Sampling from these posterior distributions is the first step to quantifying uncertainty in the fits. Here we generate 50 posterior samples, although an actual analysis would require more.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="../reference/getPosteriorSamples.html">getPosteriorSamples</a></span><span class="op">(</span><span class="va">fit</span>, nPosteriorSamples <span class="op">=</span> <span class="fl">50L</span><span class="op">)</span></code></pre></div>
</div>
<div id="get-fitted-time-courses" class="section level2">
<h2 class="hasAnchor">
<a href="#get-fitted-time-courses" class="anchor"></a>Get fitted time-courses</h2>
<p>We can use the posterior samples to quantify uncertainty in the expected measurements, i.e., the fitted curves, by specifying the <code>fitType</code> argument. Here we focus on three genes.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">genes</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'13170'</span>, <span class="st">'12686'</span>, <span class="st">'26897'</span><span class="op">)</span>,
                   symbol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Dbp'</span>, <span class="st">'Elovl3'</span>, <span class="st">'Acot1'</span><span class="op">)</span><span class="op">)</span>
<span class="va">times</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">24</span>, <span class="fl">0.5</span><span class="op">)</span>

<span class="va">measFitSamps</span> <span class="op">=</span> <span class="fu"><a href="../reference/getExpectedMeas.html">getExpectedMeas</a></span><span class="op">(</span>
  <span class="va">fit</span>, times <span class="op">=</span> <span class="va">times</span>, fitType <span class="op">=</span> <span class="st">'posterior_samples'</span>, features <span class="op">=</span> <span class="va">genes</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>
<span class="va">measFitSamps</span><span class="op">[</span><span class="va">genes</span>, <span class="va">symbol</span> <span class="op">:=</span> <span class="va">i.symbol</span>, on <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">.</a></span><span class="op">(</span>feature <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">measFitSamps</span>, nrows <span class="op">=</span> <span class="fl">10L</span><span class="op">)</span>
<span class="co">#&gt;        time      cond feature     value posterior_sample symbol</span>
<span class="co">#&gt;     1:    0 wild-type   13170  9.402824                1    Dbp</span>
<span class="co">#&gt;     2:    0 wild-type   12686 11.800712                1 Elovl3</span>
<span class="co">#&gt;     3:    0 wild-type   26897 11.485227                1  Acot1</span>
<span class="co">#&gt;     4:    0  knockout   13170 12.075180                1    Dbp</span>
<span class="co">#&gt;     5:    0  knockout   12686 10.003835                1 Elovl3</span>
<span class="co">#&gt;    ---                                                         </span>
<span class="co">#&gt; 14696:   24 wild-type   12686 11.752151               50 Elovl3</span>
<span class="co">#&gt; 14697:   24 wild-type   26897 11.613652               50  Acot1</span>
<span class="co">#&gt; 14698:   24  knockout   13170 12.119886               50    Dbp</span>
<span class="co">#&gt; 14699:   24  knockout   12686  9.973703               50 Elovl3</span>
<span class="co">#&gt; 14700:   24  knockout   26897  8.994757               50  Acot1</span></code></pre></div>
<p>Given the expected measurements from the posterior samples, we can compute the lower and upper bounds of the credible interval for each combination of feature, condition, and time-point. By default, <code><a href="../reference/getExpectedMeasIntervals.html">getExpectedMeasIntervals()</a></code> calculates the 90% equal-tailed interval.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">measFitInts</span> <span class="op">=</span> <span class="fu"><a href="../reference/getExpectedMeasIntervals.html">getExpectedMeasIntervals</a></span><span class="op">(</span><span class="va">measFitSamps</span><span class="op">)</span>
<span class="va">measFitInts</span>
<span class="co">#&gt;      time      cond feature symbol     lower     upper</span>
<span class="co">#&gt;   1:    0 wild-type   13170    Dbp  9.263319  9.573363</span>
<span class="co">#&gt;   2:    0 wild-type   12686 Elovl3 11.725544 11.935728</span>
<span class="co">#&gt;   3:    0 wild-type   26897  Acot1 11.468245 11.766287</span>
<span class="co">#&gt;   4:    0  knockout   13170    Dbp 11.851776 12.362667</span>
<span class="co">#&gt;   5:    0  knockout   12686 Elovl3  9.836541 10.137662</span>
<span class="co">#&gt;  ---                                                  </span>
<span class="co">#&gt; 290:   24 wild-type   12686 Elovl3 11.725544 11.935728</span>
<span class="co">#&gt; 291:   24 wild-type   26897  Acot1 11.468245 11.766287</span>
<span class="co">#&gt; 292:   24  knockout   13170    Dbp 11.851776 12.362667</span>
<span class="co">#&gt; 293:   24  knockout   12686 Elovl3  9.836541 10.137662</span>
<span class="co">#&gt; 294:   24  knockout   26897  Acot1  8.736497  9.222638</span></code></pre></div>
<p>It’s always a good idea to also calculate the posterior mean fitted curves.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">measFitMean</span> <span class="op">=</span> <span class="fu"><a href="../reference/getExpectedMeas.html">getExpectedMeas</a></span><span class="op">(</span><span class="va">fit</span>, times <span class="op">=</span> <span class="va">times</span>, features <span class="op">=</span> <span class="va">genes</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>
<span class="va">measFitMean</span><span class="op">[</span><span class="va">genes</span>, <span class="va">symbol</span> <span class="op">:=</span> <span class="va">i.symbol</span>, on <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">.</a></span><span class="op">(</span>feature <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>Now we can plot the results. In the first row, each curve corresponds to a posterior sample. In the second row, the ribbons indicate the credible intervals.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">timeBreaks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">24</span>, <span class="fl">4</span><span class="op">)</span>
<span class="va">pal</span> <span class="op">=</span> <span class="st">'Dark2'</span>

<span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">measFitSamps</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">'fixed'</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">cond</span>,
                group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html">interaction</a></span><span class="op">(</span><span class="va">cond</span>, <span class="va">posterior_sample</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Circadian time (h)'</span>, y <span class="op">=</span> <span class="st">'Expression (norm.)'</span>, color <span class="op">=</span> <span class="st">'Condition'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">timeBreaks</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="va">pal</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">'fixed'</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, fill <span class="op">=</span> <span class="va">cond</span><span class="op">)</span>,
              alpha <span class="op">=</span> <span class="fl">0.3</span>, data <span class="op">=</span> <span class="va">measFitInts</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">cond</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">measFitMean</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Circadian time (h)'</span>, y <span class="op">=</span> <span class="st">'Expression (norm.)'</span>, color <span class="op">=</span> <span class="st">'Condition'</span>,
       fill <span class="op">=</span> <span class="st">'Condition'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">timeBreaks</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="va">pal</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="va">pal</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span>

<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">1</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.25</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="uncertainty_files/figure-html/plot_timecourse_samps-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="get-rhythmic-and-differentially-rhythmic-statistics" class="section level2">
<h2 class="hasAnchor">
<a href="#get-rhythmic-and-differentially-rhythmic-statistics" class="anchor"></a>Get rhythmic and differentially rhythmic statistics</h2>
<p>We can also use the posterior samples to quantify uncertainty in the statistics, again by specifying the <code>fitType</code> argument.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rhyStatsSamps</span> <span class="op">=</span> <span class="fu"><a href="../reference/getRhythmStats.html">getRhythmStats</a></span><span class="op">(</span><span class="va">fit</span>, features <span class="op">=</span> <span class="va">genes</span><span class="op">$</span><span class="va">id</span>, fitType <span class="op">=</span> <span class="st">'posterior_samples'</span><span class="op">)</span>
<span class="va">diffRhyStatsSamps</span> <span class="op">=</span> <span class="fu"><a href="../reference/getDiffRhythmStats.html">getDiffRhythmStats</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">rhyStatsSamps</span>, <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">cond</span><span class="op">)</span><span class="op">)</span>
<span class="va">diffRhyStatsSamps</span><span class="op">[</span><span class="va">genes</span>, <span class="va">symbol</span> <span class="op">:=</span> <span class="va">i.symbol</span>, on <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">.</a></span><span class="op">(</span>feature <span class="op">=</span> <span class="va">id</span><span class="op">)</span><span class="op">]</span>
<span class="va">diffRhyStatsSamps</span>
<span class="co">#&gt;      feature posterior_sample diff_mean_value diff_peak_trough_amp diff_rms_amp</span>
<span class="co">#&gt;   1:   13170                1       1.0819454           -3.4427084   -1.2238978</span>
<span class="co">#&gt;   2:   13170                1       1.0819454           -3.4427084   -1.2238978</span>
<span class="co">#&gt;   3:   12686                1      -0.3953509           -2.5340386   -0.8916827</span>
<span class="co">#&gt;   4:   26897                1      -2.4249143           -0.4834803   -0.1821129</span>
<span class="co">#&gt;   5:   13170                2       1.2670910           -3.5600806   -1.2514805</span>
<span class="co">#&gt;  ---                                                                           </span>
<span class="co">#&gt; 196:   26897               49      -2.3777923           -0.7791923   -0.2989644</span>
<span class="co">#&gt; 197:   13170               50       1.2323139           -3.7327533   -1.3077558</span>
<span class="co">#&gt; 198:   13170               50       1.2323139           -3.7327533   -1.3077558</span>
<span class="co">#&gt; 199:   12686               50      -0.3985237           -2.1185767   -0.7237694</span>
<span class="co">#&gt; 200:   26897               50      -2.3604572           -0.5149334   -0.2039720</span>
<span class="co">#&gt;      diff_peak_phase diff_trough_phase rms_diff_rhy symbol</span>
<span class="co">#&gt;   1:      -2.0205604        -0.5323691     3.406233    Dbp</span>
<span class="co">#&gt;   2:      -2.0205604        -0.5323691     3.373949    Dbp</span>
<span class="co">#&gt;   3:      -4.7087638         0.3156116     2.863966 Elovl3</span>
<span class="co">#&gt;   4:      -0.5385628        -2.6868375     1.309783  Acot1</span>
<span class="co">#&gt;   5:      -0.5607122        -0.0173358     2.655987    Dbp</span>
<span class="co">#&gt;  ---                                                      </span>
<span class="co">#&gt; 196:      -1.4635654        -3.8772425     1.324590  Acot1</span>
<span class="co">#&gt; 197:      -0.3402539        -0.1905009     3.756718    Dbp</span>
<span class="co">#&gt; 198:      -0.3402539        -0.1905009     2.805770    Dbp</span>
<span class="co">#&gt; 199:      -5.4143044        -2.1773275     2.769864 Elovl3</span>
<span class="co">#&gt; 200:      -1.6353359        -4.4135799     1.655238  Acot1</span></code></pre></div>
<p>In the plots below, each point represents a posterior sample.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">diffRhyStatsSamps</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">diff_peak_trough_amp</span>, y <span class="op">=</span> <span class="va">diff_mean_value</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Difference in peak-to-trough amplitude (norm.)'</span>,
       y <span class="op">=</span> <span class="st">'Difference in mean value (norm.)'</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">diffRhyStatsSamps</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">diff_peak_trough_amp</span>, y <span class="op">=</span> <span class="va">diff_peak_phase</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Difference in peak-to-trough amplitude (norm.)'</span>,
       y <span class="op">=</span> <span class="st">'Difference in peak phase (h)'</span><span class="op">)</span>

<span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="uncertainty_files/figure-html/plot_stats_samps-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Finally, we can compute credible intervals for the rhythmic and differentially rhythmic statistics. Again, by default these are 90% equal-tailed intervals. Currently <code><a href="../reference/getStatsIntervals.html">getStatsIntervals()</a></code> does not calculate intervals for phase-based statistics, since phase and phase difference are circular quantities.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rhyStatsInts</span> <span class="op">=</span> <span class="fu"><a href="../reference/getStatsIntervals.html">getStatsIntervals</a></span><span class="op">(</span><span class="va">rhyStatsSamps</span><span class="op">)</span>
<span class="va">rhyStatsInts</span>
<span class="co">#&gt;          cond feature       statistic      lower      upper</span>
<span class="co">#&gt;  1: wild-type   13170      peak_value 14.9003728 15.1539605</span>
<span class="co">#&gt;  2: wild-type   12686      peak_value 11.7344768 11.9443210</span>
<span class="co">#&gt;  3: wild-type   26897      peak_value 12.1294984 12.4686072</span>
<span class="co">#&gt;  4:  knockout   13170      peak_value 14.1093733 14.4242729</span>
<span class="co">#&gt;  5:  knockout   12686      peak_value 10.0977463 10.5342400</span>
<span class="co">#&gt;  6:  knockout   26897      peak_value  9.6027626 10.1284293</span>
<span class="co">#&gt;  7: wild-type   13170    trough_value  8.8886467  9.2171619</span>
<span class="co">#&gt;  8: wild-type   12686    trough_value  8.7211936  8.8902508</span>
<span class="co">#&gt;  9: wild-type   26897    trough_value 10.6152130 10.9903451</span>
<span class="co">#&gt; 10:  knockout   13170    trough_value 11.5676363 12.0854481</span>
<span class="co">#&gt; 11:  knockout   12686    trough_value  9.4942736  9.7506106</span>
<span class="co">#&gt; 12:  knockout   26897    trough_value  8.6422448  9.0583598</span>
<span class="co">#&gt; 13: wild-type   13170 peak_trough_amp  5.7293693  6.2560320</span>
<span class="co">#&gt; 14: wild-type   12686 peak_trough_amp  2.8482097  3.2227375</span>
<span class="co">#&gt; 15: wild-type   26897 peak_trough_amp  1.1323265  1.7766711</span>
<span class="co">#&gt; 16:  knockout   13170 peak_trough_amp  2.0865324  2.8290387</span>
<span class="co">#&gt; 17:  knockout   12686 peak_trough_amp  0.4068168  0.9257163</span>
<span class="co">#&gt; 18:  knockout   26897 peak_trough_amp  0.5793250  1.4306786</span>
<span class="co">#&gt; 19: wild-type   13170         rms_amp  2.0159445  2.2070023</span>
<span class="co">#&gt; 20: wild-type   12686         rms_amp  0.9987997  1.1285578</span>
<span class="co">#&gt; 21: wild-type   26897         rms_amp  0.4005570  0.6317788</span>
<span class="co">#&gt; 22:  knockout   13170         rms_amp  0.7519981  1.0042769</span>
<span class="co">#&gt; 23:  knockout   12686         rms_amp  0.1404852  0.3368101</span>
<span class="co">#&gt; 24:  knockout   26897         rms_amp  0.1782355  0.4773542</span>
<span class="co">#&gt;          cond feature       statistic      lower      upper</span>

<span class="va">diffRhyStatsInts</span> <span class="op">=</span> <span class="fu"><a href="../reference/getStatsIntervals.html">getStatsIntervals</a></span><span class="op">(</span><span class="va">diffRhyStatsSamps</span><span class="op">)</span>
<span class="va">diffRhyStatsInts</span>
<span class="co">#&gt;     feature            statistic      lower       upper</span>
<span class="co">#&gt;  1:   13170      diff_mean_value  1.1144320  1.28116262</span>
<span class="co">#&gt;  2:   12686      diff_mean_value -0.5003404 -0.35647511</span>
<span class="co">#&gt;  3:   26897      diff_mean_value -2.4674729 -2.30541048</span>
<span class="co">#&gt;  4:   13170 diff_peak_trough_amp -3.7545899 -3.22205097</span>
<span class="co">#&gt;  5:   12686 diff_peak_trough_amp -2.6833705 -2.08241631</span>
<span class="co">#&gt;  6:   26897 diff_peak_trough_amp -0.9525256 -0.14286448</span>
<span class="co">#&gt;  7:   13170         diff_rms_amp -1.3126531 -1.12226704</span>
<span class="co">#&gt;  8:   12686         diff_rms_amp -0.9189768 -0.71207487</span>
<span class="co">#&gt;  9:   26897         diff_rms_amp -0.3486025 -0.06474641</span>
<span class="co">#&gt; 10:   13170         rms_diff_rhy  2.8227717  3.82358777</span>
<span class="co">#&gt; 11:   12686         rms_diff_rhy  2.4983826  3.11943021</span>
<span class="co">#&gt; 12:   26897         rms_diff_rhy  0.8296640  1.67998322</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jake Hughey, Dora Obodo, Elliot Outland.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
